<?xml version="1.0"?>
<!--
/**
 * Copyright Â© 2015 Magento. All rights reserved.
 * See COPYING.txt for license details.
 */
-->
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <preference for="OnTap\Tns\Api\SessionInformationManagementInterface" type="OnTap\Tns\Model\SessionInformationManagement" />

    <!-- Virtual operation classes that specify apiOperation generically -->
    <virtualType name="AuthorizeOperationDataBuilder" type="OnTap\Tns\Gateway\Request\OperationBuilder">
        <arguments>
            <argument name="operation" xsi:type="string">AUTHORIZE</argument>
        </arguments>
    </virtualType>
    <virtualType name="CreateSessionOperationDataBuilder" type="OnTap\Tns\Gateway\Request\OperationBuilder">
        <arguments>
            <argument name="operation" xsi:type="string">CREATE_CHECKOUT_SESSION</argument>
        </arguments>
    </virtualType>
    <virtualType name="CaptureOperationDataBuilder" type="OnTap\Tns\Gateway\Request\OperationBuilder">
        <arguments>
            <argument name="operation" xsi:type="string">CAPTURE</argument>
        </arguments>
    </virtualType>
    <virtualType name="SaleOperationDataBuilder" type="OnTap\Tns\Gateway\Request\OperationBuilder">
        <arguments>
            <argument name="operation" xsi:type="string">PAY</argument>
        </arguments>
    </virtualType>
    <virtualType name="RefundOperationDataBuilder" type="OnTap\Tns\Gateway\Request\OperationBuilder">
        <arguments>
            <argument name="operation" xsi:type="string">REFUND</argument>
        </arguments>
    </virtualType>
    <virtualType name="VoidOperationDataBuilder" type="OnTap\Tns\Gateway\Request\OperationBuilder">
        <arguments>
            <argument name="operation" xsi:type="string">VOID</argument>
        </arguments>
    </virtualType>
    <virtualType name="ThreeDSecureCheckOperationDataBuilder" type="OnTap\Tns\Gateway\Request\OperationBuilder">
        <arguments>
            <argument name="operation" xsi:type="string">CHECK_3DS_ENROLLMENT</argument>
        </arguments>
    </virtualType>
    <virtualType name="ThreeDSecureProcessOperationDataBuilder" type="OnTap\Tns\Gateway\Request\OperationBuilder">
        <arguments>
            <argument name="operation" xsi:type="string">PROCESS_ACS_RESULT</argument>
        </arguments>
    </virtualType>

    <type name="OnTap\Tns\Gateway\Http\Client\Rest">
        <arguments>
            <argument name="logger" xsi:type="object">TnsLogger</argument>
            <argument name="converter" xsi:type="object">OnTap\Tns\Gateway\Http\Converter\JsonToArray</argument>
            <argument name="adapter" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Adapter\Rest</argument>
        </arguments>
    </type>

    <!-- Check 3D-Secure enrollment -->
    <virtualType name="TnsThreeDSecureEnrollmentCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsThreeDSecureDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">OnTap\Tns\Gateway\Http\ThreeDSecure\TransferFactoryEnrolment</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">OnTap\Tns\Gateway\Validator\ThreeDSecureValidator</argument>
            <argument name="handler" xsi:type="object">OnTap\Tns\Gateway\Response\ThreeDSecure\CheckHandler</argument>
        </arguments>
    </virtualType>
    <virtualType name="TnsThreeDSecureDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">ThreeDSecureCheckOperationDataBuilder</item>
                <item name="3ds_check" xsi:type="string">OnTap\Tns\Gateway\Request\ThreeDSecure\CheckDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsVoidDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">VoidOperationDataBuilder</item>
                <item name="void" xsi:type="string">OnTap\Tns\Gateway\Request\VoidDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsRefundDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">RefundOperationDataBuilder</item>
                <item name="refund" xsi:type="string">OnTap\Tns\Gateway\Request\TransactionDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsCaptureDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">CaptureOperationDataBuilder</item>
                <item name="capture" xsi:type="string">OnTap\Tns\Gateway\Request\TransactionDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsAuthorizeResponseHandler" type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="transaction" xsi:type="string">OnTap\Tns\Gateway\Response\TransactionIdHandler</item>
                <item name="authorize" xsi:type="string">OnTap\Tns\Gateway\Response\AuthorizeHandler</item>
                <item name="payment" xsi:type="string">OnTap\Tns\Gateway\Response\PaymentHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="OnTap\Payment\Gateway\Command\CommandManagerPool">
        <arguments>
            <argument name="executors" xsi:type="array">
                <item name="tns_direct" xsi:type="string">TnsDirectCommandManager</item>
                <item name="tns_hpf" xsi:type="string">TnsHpfCommandManager</item>
            </argument>
        </arguments>
    </type>

    <!-- ********** -->
    <!-- DIRECT API -->
    <!-- ********** -->
    <virtualType name="TnsDirectCommandManager" type="OnTap\Payment\Gateway\Command\CommandManager">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsDirectCommandPool</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectInfoBlock" type="OnTap\Tns\Block\Direct\Info">
        <arguments>
            <argument name="data" xsi:type="array">
                <item xsi:type="string" name="is_secure_mode">0</item>
            </argument>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectConfig" type="OnTap\Tns\Gateway\Config\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">OnTap\Tns\Model\Ui\Direct\ConfigProvider::METHOD_CODE</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="3ds_process" xsi:type="string">TnsDirectThreeDSecureProcessCommand</item>
                <item name="authorize" xsi:type="string">AuthorizeStrategyCommand</item>
                <item name="authorize_simple" xsi:type="string">AuthorizeCommand</item>
                <item name="capture" xsi:type="string">CaptureStrategyCommand</item>
                <item name="capture_simple" xsi:type="string">TnsDirectSaleStrategyCommand</item>
                <item name="sale" xsi:type="string">TnsDirectSaleCommand</item>
                <item name="pre_auth_capture" xsi:type="string">TnsDirectPreAuthCaptureCommand</item>
                <item name="refund" xsi:type="string">TnsDirectRefundCommand</item>
                <item name="void" xsi:type="string">TnsDirectVoidCommand</item>
                <item name="create_token" xsi:type="string">TnsDirectCreateTokenCommand</item>
                <item name="vault_sale" xsi:type="string">TnsDirectVaultSaleCommand</item>
                <item name="vault_authorize" xsi:type="string">TnsDirectVaultAuthorizeCommand</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectFacade" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code" xsi:type="const">OnTap\Tns\Model\Ui\Direct\ConfigProvider::METHOD_CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form\Cc</argument>
            <argument name="infoBlockType" xsi:type="string">TnsDirectInfoBlock</argument>
            <argument name="valueHandlerPool" xsi:type="object">TnsValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">TnsDirectValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">TnsDirectCommandPool</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">TnsDirectCountryValidator</item>
                <item name="currency" xsi:type="string">TnsDirectCurrencyValidator</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectCurrencyValidator" type="OnTap\Tns\Gateway\Validator\CurrencyValidator">
        <arguments>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">TnsDirectConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">TnsConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Create a token in gateway -->
    <virtualType name="TnsDirectCreateTokenCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">OnTap\Tns\Gateway\Request\Direct\CardDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">OnTap\Tns\Gateway\Http\Vault\TransferFactoryCreateToken</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">TnsDirectTokenCreateHandler</argument>
            <argument name="validator" xsi:type="object">OnTap\Tns\Gateway\Validator\TokenCreateValidator</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectTokenCreateHandler" type="OnTap\Tns\Gateway\Response\TokenCreateHandler">
        <arguments>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
        </arguments>
    </virtualType>

    <!-- Pure authorize command (VAULT) -->
    <virtualType name="TnsDirectVaultAuthorizeCommand" type="AuthorizeCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsDirectVaultAuthorizeDataBuilder</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectVaultAuthorizeDataBuilder" type="TnsDirectAuthorizeDataBuilder">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="card" xsi:type="string">OnTap\Tns\Gateway\Request\TokenDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Sale (VAULT) -->
    <virtualType name="TnsDirectVaultSaleCommand" type="TnsDirectSaleCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsDirectVaultSaleDataBuilder</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectVaultSaleDataBuilder" type="TnsDirectSaleDataBuilder">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="card" xsi:type="string">OnTap\Tns\Gateway\Request\TokenDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Pure authorize command -->
    <virtualType name="AuthorizeCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsDirectAuthorizeDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">OnTap\Tns\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">TnsAuthorizeResponseHandler</argument>
            <argument name="validator" xsi:type="object">OnTap\Tns\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Authorize -->
    <virtualType name="AuthorizeStrategyCommand" type="OnTap\Tns\Gateway\Command\VerificationStrategyCommand">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsDirectCommandPool</argument>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
            <argument name="successCommand" xsi:type="string">authorize_simple</argument>
        </arguments>
    </virtualType>

    <!-- Capture -->
    <virtualType name="CaptureStrategyCommand" type="OnTap\Tns\Gateway\Command\VerificationStrategyCommand">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsDirectCommandPool</argument>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
            <argument name="successCommand" xsi:type="string">capture_simple</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectSaleStrategyCommand" type="OnTap\Tns\Gateway\Command\SaleStrategyCommand">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsDirectCommandPool</argument>
        </arguments>
    </virtualType>

    <!-- Authorize + Capture command aka. Sale -->
    <virtualType name="TnsDirectSaleCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsDirectSaleDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">OnTap\Tns\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">TnsDirectSaleResponseHandler</argument>
            <argument name="validator" xsi:type="object">OnTap\Tns\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Capture a pre-authorized payment (DIRECT) -->
    <virtualType name="TnsDirectPreAuthCaptureCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsCaptureDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">OnTap\Tns\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">OnTap\Tns\Gateway\Response\TransactionIdHandler</argument>
            <argument name="validator" xsi:type="object">OnTap\Tns\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Void -->
    <virtualType name="TnsDirectVoidCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsVoidDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">OnTap\Tns\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">OnTap\Tns\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Refund -->
    <virtualType name="TnsDirectRefundCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsRefundDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">OnTap\Tns\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">OnTap\Tns\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Verify 3D-Secure results -->
    <virtualType name="TnsDirectThreeDSecureProcessCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Tns3DSecureVerifyDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">OnTap\Tns\Gateway\Http\ThreeDSecure\TransferFactoryProcess</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">TnsDirectThreeDSecureResultValidator</argument>
            <argument name="handler" xsi:type="object">OnTap\Tns\Gateway\Response\ThreeDSecure\ResultHandler</argument>
        </arguments>
    </virtualType>
    <virtualType name="Tns3DSecureVerifyDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">ThreeDSecureProcessOperationDataBuilder</item>
                <item name="3ds_process" xsi:type="string">OnTap\Tns\Gateway\Request\ThreeDSecure\ProcessDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectThreeDSecureResultValidator" type="Magento\Payment\Gateway\Validator\ValidatorComposite">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="response" xsi:type="string">OnTap\Tns\Gateway\Validator\ThreeDSecureValidator</item>
                <item name="session" xsi:type="string">OnTap\Tns\Gateway\Validator\ThreeDSecure\ProcessValidator</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectThreeDSecureResultDataBuilder" type="OnTap\Tns\Gateway\Request\ThreeDSecure\ResultsDataBuilder">
        <arguments>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
        </arguments>
    </virtualType>

    <type name="OnTap\Tns\Gateway\Http\TransferFactory">
        <arguments>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
        </arguments>
    </type>

    <virtualType name="TnsLogger" type="Magento\Payment\Model\Method\Logger">
        <arguments>
            <argument name="config" xsi:type="object">TnsDirectConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectAuthorizeDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">AuthorizeOperationDataBuilder</item>
                <item name="card" xsi:type="string">OnTap\Tns\Gateway\Request\Direct\CardDataBuilder</item>
                <item name="order" xsi:type="string">OnTap\Tns\Gateway\Request\OrderDataBuilder</item>
                <item name="billing" xsi:type="string">OnTap\Tns\Gateway\Request\BillingDataBuilder</item>
                <item name="shipping" xsi:type="string">OnTap\Tns\Gateway\Request\ShippingDataBuilder</item>
                <item name="customer" xsi:type="string">OnTap\Tns\Gateway\Request\CustomerDataBuilder</item>
                <item name="3ds_results" xsi:type="string">TnsDirectThreeDSecureResultDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectSaleDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">SaleOperationDataBuilder</item>
                <item name="card" xsi:type="string">OnTap\Tns\Gateway\Request\Direct\CardDataBuilder</item>
                <item name="order" xsi:type="string">OnTap\Tns\Gateway\Request\OrderDataBuilder</item>
                <item name="billing" xsi:type="string">OnTap\Tns\Gateway\Request\BillingDataBuilder</item>
                <item name="shipping" xsi:type="string">OnTap\Tns\Gateway\Request\ShippingDataBuilder</item>
                <item name="customer" xsi:type="string">OnTap\Tns\Gateway\Request\CustomerDataBuilder</item>
                <item name="3ds_results" xsi:type="string">TnsDirectThreeDSecureResultDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsDirectSaleResponseHandler" type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="transaction" xsi:type="string">OnTap\Tns\Gateway\Response\TransactionIdHandler</item>
                <item name="capture" xsi:type="string">OnTap\Tns\Gateway\Response\CaptureHandler</item>
                <item name="payment" xsi:type="string">OnTap\Tns\Gateway\Response\PaymentHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- *************** -->
    <!-- HOSTED CHECKOUT -->
    <!-- *************** -->
    <virtualType name="TnsHostedInfoBlock" type="OnTap\Tns\Block\Direct\Info">
        <arguments>
            <argument name="data" xsi:type="array">
                <item xsi:type="string" name="is_secure_mode">0</item>
            </argument>
            <argument name="config" xsi:type="object">TnsHostedConfig</argument>
        </arguments>
    </virtualType>

    <type name="OnTap\Tns\Model\SessionInformationManagement">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsHostedCommandPool</argument>
        </arguments>
    </type>

    <virtualType name="TnsHostedConfig" type="OnTap\Tns\Gateway\Config\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">OnTap\Tns\Model\Ui\Hosted\ConfigProvider::METHOD_CODE</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHostedCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="create_session" xsi:type="string">TnsHostedCreateSessionCommand</item>
                <item name="authorize" xsi:type="string">TnsHostedRetrieveOrderCommand</item>
                <item name="retrieve_order" xsi:type="string">TnsHostedRetrieveOrderCommand</item>
                <item name="capture" xsi:type="string">TnsHostedCaptureStrategyCommand</item>
                <item name="capture_simple" xsi:type="string">TnsHostedPreAuthCaptureCommand</item>
                <item name="refund" xsi:type="string">TnsHostedRefundCommand</item>
                <item name="void" xsi:type="string">TnsHostedVoidCommand</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="TnsHostedFacade" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code" xsi:type="const">OnTap\Tns\Model\Ui\Hosted\ConfigProvider::METHOD_CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form\Cc</argument>
            <argument name="infoBlockType" xsi:type="string">TnsHostedInfoBlock</argument>
            <argument name="valueHandlerPool" xsi:type="object">TnsHostedValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">TnsHostedValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">TnsHostedCommandPool</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHostedValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">TnsHostedCountryValidator</item>
                <item name="currency" xsi:type="string">TnsHostedCurrencyValidator</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHostedCurrencyValidator" type="OnTap\Tns\Gateway\Validator\CurrencyValidator">
        <arguments>
            <argument name="config" xsi:type="object">TnsHostedConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHostedCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">TnsHostedConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHostedConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">TnsHostedConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHostedValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">TnsHostedConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Capture -->
    <virtualType name="TnsHostedCaptureStrategyCommand" type="OnTap\Tns\Gateway\Command\Hosted\CaptureStrategyCommand">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsHostedCommandPool</argument>
            <argument name="config" xsi:type="object">TnsHostedConfig</argument>
        </arguments>
    </virtualType>

    <!-- Create a HC session -->
    <virtualType name="TnsHostedCreateSessionCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsHostedSessionDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">OnTap\Tns\Gateway\Http\Hosted\TransferFactorySession</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">OnTap\Tns\Gateway\Response\Hosted\SessionHandler</argument>
            <argument name="validator" xsi:type="object">OnTap\Tns\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Verify HC payment -->
    <virtualType name="TnsHostedRetrieveOrderCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">OnTap\Tns\Gateway\Request\Hosted\RetrieveOrderDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">OnTap\Tns\Gateway\Http\Hosted\TransferFactoryOrder</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">OnTap\Tns\Gateway\Response\Hosted\TransactionHandler</argument>
            <argument name="validator" xsi:type="object">TnsHostedOrderValidator</argument>
        </arguments>
    </virtualType>

    <!-- Capture a pre-authorized payment (HC) -->
    <virtualType name="TnsHostedPreAuthCaptureCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsCaptureDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">HostedTransferFactory</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">OnTap\Tns\Gateway\Response\TransactionIdHandler</argument>
            <argument name="validator" xsi:type="object">OnTap\Tns\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Refund (HC) -->
    <virtualType name="TnsHostedRefundCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsRefundDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">HostedTransferFactory</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">OnTap\Tns\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Void (HC) -->
    <virtualType name="TnsHostedVoidCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsVoidDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">HostedTransferFactory</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">OnTap\Tns\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHostedOrderValidator" type="Magento\Payment\Gateway\Validator\ValidatorComposite">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="response" xsi:type="string">OnTap\Tns\Gateway\Validator\ResponseValidator</item>
                <item name="session" xsi:type="string">OnTap\Tns\Gateway\Validator\Hosted\SessionIndicatorValidator</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="OnTap\Tns\Gateway\Http\Hosted\TransferFactorySession">
        <arguments>
            <argument name="config" xsi:type="object">TnsHostedConfig</argument>
        </arguments>
    </type>

    <virtualType name="HostedTransferFactory" type="OnTap\Tns\Gateway\Http\TransferFactory">
        <arguments>
            <argument name="config" xsi:type="object">TnsHostedConfig</argument>
        </arguments>
    </virtualType>

    <type name="OnTap\Tns\Gateway\Http\Hosted\TransferFactoryOrder">
        <arguments>
            <argument name="config" xsi:type="object">TnsHostedConfig</argument>
        </arguments>
    </type>

    <virtualType name="TnsHostedSessionDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">CreateSessionOperationDataBuilder</item>
                <item name="order" xsi:type="string">OnTap\Tns\Gateway\Request\Hosted\OrderDataBuilder</item>
                <item name="billing" xsi:type="string">OnTap\Tns\Gateway\Request\BillingDataBuilder</item>
                <item name="shipping" xsi:type="string">OnTap\Tns\Gateway\Request\ShippingDataBuilder</item>
                <item name="customer" xsi:type="string">OnTap\Tns\Gateway\Request\CustomerDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- ******************* -->
    <!-- HOSTED PAYMENT FORM -->
    <!-- ******************* -->
    <virtualType name="TnsHpfCommandManager" type="OnTap\Payment\Gateway\Command\CommandManager">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsHpfCommandPool</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfInfoBlock" type="OnTap\Tns\Block\Direct\Info">
        <arguments>
            <argument name="data" xsi:type="array">
                <item xsi:type="string" name="is_secure_mode">0</item>
            </argument>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
        </arguments>
    </virtualType>
    <virtualType name="TnsHpfConfig" type="OnTap\Tns\Gateway\Config\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">OnTap\Tns\Model\Ui\Hpf\ConfigProvider::METHOD_CODE</argument>
        </arguments>
    </virtualType>
    <virtualType name="TnsHpfValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">TnsHpfConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="TnsHpfConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">TnsHpfConfig</argument>
        </arguments>
    </virtualType>
    <virtualType name="TnsHpfFacade" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code" xsi:type="const">OnTap\Tns\Model\Ui\Hpf\ConfigProvider::METHOD_CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form\Cc</argument>
            <argument name="infoBlockType" xsi:type="string">TnsHpfInfoBlock</argument>
            <argument name="valueHandlerPool" xsi:type="object">TnsHpfValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">TnsHpfValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">TnsHpfCommandPool</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">TnsHpfCountryValidator</item>
                <item name="currency" xsi:type="string">TnsHpfCurrencyValidator</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfCurrencyValidator" type="OnTap\Tns\Gateway\Validator\CurrencyValidator">
        <arguments>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="authorize" xsi:type="string">TnsHpfAuthorizeStrategyCommand</item>
                <item name="authorize_simple" xsi:type="string">TnsHpfAuthorizeCommand</item>
                <item name="3ds_process" xsi:type="string">TnsHpf3dsProcessCommand</item>
                <item name="capture" xsi:type="string">TnsHpfCaptureStrategyCommand</item>
                <item name="capture_simple" xsi:type="string">TnsHpfSaleStrategyCommand</item>
                <item name="sale" xsi:type="string">TnsHpfSaleCommand</item>
                <item name="pre_auth_capture" xsi:type="string">TnsHpfPreAuthCaptureCommand</item>
                <item name="refund" xsi:type="string">TnsHpfRefundCommand</item>
                <item name="void" xsi:type="string">TnsHpfVoidCommand</item>
                <item name="create_token" xsi:type="string">TnsHpfCreateTokenCommand</item>
                <item name="vault_sale" xsi:type="string">TnsHpfVaultSaleCommand</item>
                <item name="vault_authorize" xsi:type="string">TnsHpfVaultAuthorizeCommand</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Pure authorize command (VAULT) -->
    <virtualType name="TnsHpfVaultAuthorizeCommand" type="TnsHpfAuthorizeCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsHpfVaultAuthorizeDataBuilder</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfVaultAuthorizeDataBuilder" type="TnsHpfAuthorizeDataBuilder">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="card" xsi:type="string">OnTap\Tns\Gateway\Request\TokenDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Sale (VAULT) -->
    <virtualType name="TnsHpfVaultSaleCommand" type="TnsHpfSaleCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsHpfVaultSaleDataBuilder</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfVaultSaleDataBuilder" type="TnsHpfSaleDataBuilder">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="card" xsi:type="string">OnTap\Tns\Gateway\Request\TokenDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Create a token in gateway -->
    <virtualType name="TnsHpfCreateTokenCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">OnTap\Tns\Gateway\Request\Hpf\SessionDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">OnTap\Tns\Gateway\Http\Vault\TransferFactoryCreateToken</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">TnsHpfTokenCreateHandler</argument>
            <argument name="validator" xsi:type="object">OnTap\Tns\Gateway\Validator\TokenCreateValidator</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfTokenCreateHandler" type="OnTap\Tns\Gateway\Response\TokenCreateHandler">
        <arguments>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
        </arguments>
    </virtualType>

    <!-- Void -->
    <virtualType name="TnsHpfVoidCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsVoidDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">TnsHpfTransferFactory</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">OnTap\Tns\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Refund -->
    <virtualType name="TnsHpfRefundCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsRefundDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">TnsHpfTransferFactory</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">OnTap\Tns\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Authorize + Capture command aka. Sale -->
    <virtualType name="TnsHpfSaleCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsHpfSaleDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">TnsHpfTransferFactory</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">TnsHpfSaleResponseHandler</argument>
            <argument name="validator" xsi:type="object">OnTap\Tns\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>
    <virtualType name="TnsHpfSaleResponseHandler" type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="transaction" xsi:type="string">OnTap\Tns\Gateway\Response\TransactionIdHandler</item>
                <item name="capture" xsi:type="string">OnTap\Tns\Gateway\Response\CaptureHandler</item>
                <item name="payment" xsi:type="string">OnTap\Tns\Gateway\Response\PaymentHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="TnsHpfSaleDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">SaleOperationDataBuilder</item>
                <item name="card" xsi:type="string">OnTap\Tns\Gateway\Request\Hpf\SessionDataBuilder</item>
                <item name="order" xsi:type="string">OnTap\Tns\Gateway\Request\OrderDataBuilder</item>
                <item name="billing" xsi:type="string">OnTap\Tns\Gateway\Request\BillingDataBuilder</item>
                <item name="shipping" xsi:type="string">OnTap\Tns\Gateway\Request\ShippingDataBuilder</item>
                <item name="customer" xsi:type="string">OnTap\Tns\Gateway\Request\CustomerDataBuilder</item>
                <item name="3ds_results" xsi:type="string">TnsHpfThreeDSecureResultDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Capture a pre-authorized payment (HPF) -->
    <virtualType name="TnsHpfPreAuthCaptureCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsCaptureDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">TnsHpfTransferFactory</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">OnTap\Tns\Gateway\Response\TransactionIdHandler</argument>
            <argument name="validator" xsi:type="object">OnTap\Tns\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Capture -->
    <virtualType name="TnsHpfCaptureStrategyCommand" type="OnTap\Tns\Gateway\Command\VerificationStrategyCommand">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsHpfCommandPool</argument>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
            <argument name="successCommand" xsi:type="string">capture_simple</argument>
        </arguments>
    </virtualType>
    <virtualType name="TnsHpfSaleStrategyCommand" type="OnTap\Tns\Gateway\Command\SaleStrategyCommand">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsHpfCommandPool</argument>
        </arguments>
    </virtualType>

    <!-- Authorize -->
    <virtualType name="TnsHpfAuthorizeStrategyCommand" type="OnTap\Tns\Gateway\Command\VerificationStrategyCommand">
        <arguments>
            <argument name="commandPool" xsi:type="object">TnsHpfCommandPool</argument>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
            <argument name="successCommand" xsi:type="string">authorize_simple</argument>
        </arguments>
    </virtualType>

    <!-- Pure authorize command -->
    <virtualType name="TnsHpfAuthorizeCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">TnsHpfAuthorizeDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">TnsHpfTransferFactory</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="handler" xsi:type="object">TnsAuthorizeResponseHandler</argument>
            <argument name="validator" xsi:type="object">OnTap\Tns\Gateway\Validator\ResponseValidator</argument>
        </arguments>
    </virtualType>

    <!-- Verify 3D-Secure results -->
    <virtualType name="TnsHpf3dsProcessCommand" type="OnTap\Tns\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Tns3DSecureVerifyDataBuilder</argument>
            <argument name="transferFactory" xsi:type="object">OnTap\Tns\Gateway\Http\ThreeDSecure\TransferFactoryProcess</argument>
            <argument name="client" xsi:type="object">OnTap\Tns\Gateway\Http\Client\Rest</argument>
            <argument name="validator" xsi:type="object">TnsHpfThreeDSecureResultValidator</argument>
            <argument name="handler" xsi:type="object">OnTap\Tns\Gateway\Response\ThreeDSecure\ResultHandler</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfThreeDSecureResultValidator" type="Magento\Payment\Gateway\Validator\ValidatorComposite">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="response" xsi:type="string">OnTap\Tns\Gateway\Validator\ThreeDSecureValidator</item>
                <item name="session" xsi:type="string">OnTap\Tns\Gateway\Validator\ThreeDSecure\ProcessValidator</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfAuthorizeDataBuilder" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">AuthorizeOperationDataBuilder</item>
                <item name="session" xsi:type="string">OnTap\Tns\Gateway\Request\Hpf\SessionDataBuilder</item>
                <item name="order" xsi:type="string">OnTap\Tns\Gateway\Request\OrderDataBuilder</item>
                <item name="billing" xsi:type="string">OnTap\Tns\Gateway\Request\BillingDataBuilder</item>
                <item name="shipping" xsi:type="string">OnTap\Tns\Gateway\Request\ShippingDataBuilder</item>
                <item name="customer" xsi:type="string">OnTap\Tns\Gateway\Request\CustomerDataBuilder</item>
                <item name="3ds_results" xsi:type="string">TnsHpfThreeDSecureResultDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfTransferFactory" type="OnTap\Tns\Gateway\Http\TransferFactory">
        <arguments>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="TnsHpfThreeDSecureResultDataBuilder" type="OnTap\Tns\Gateway\Request\ThreeDSecure\ResultsDataBuilder">
        <arguments>
            <argument name="config" xsi:type="object">TnsHpfConfig</argument>
        </arguments>
    </virtualType>
</config>
